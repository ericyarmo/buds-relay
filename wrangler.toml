name = "buds-relay"
main = "src/index.ts"
compatibility_date = "2024-01-01"

# Development environment
[env.dev]
name = "buds-relay-dev"

# Observability - Enable logs for debugging
[env.dev.observability]
enabled = true

[env.dev.observability.logs]
enabled = true
head_sampling_rate = 1
invocation_logs = true

# KV namespace for Firebase public key caching
[[env.dev.kv_namespaces]]
binding = "KV_CACHE"
id = "5019bafb2abf4e62a3c641df0db8d187"

# D1 Database
[[env.dev.d1_databases]]
binding = "DB"
database_name = "buds-relay-db"
database_id = "1ad09189-17cd-4efe-8bc1-7cd8b195769b"

# R2 Object Storage for encrypted message payloads
[[env.dev.r2_buckets]]
binding = "R2_MESSAGES"
bucket_name = "buds-messages-dev"

# Environment variables
[env.dev.vars]
ENVIRONMENT = "development"
FIREBASE_PROJECT_ID = "buds-a32e0"

# Production environment
[env.production]
name = "buds-relay"

# Observability - Enable logs for production monitoring
[env.production.observability]
enabled = true

[env.production.observability.logs]
enabled = true
head_sampling_rate = 1
invocation_logs = true

# KV namespace for Firebase public key caching (production)
[[env.production.kv_namespaces]]
binding = "KV_CACHE"
id = "5019bafb2abf4e62a3c641df0db8d187"

# D1 Database (production)
[[env.production.d1_databases]]
binding = "DB"
database_name = "buds-relay-db"
database_id = "1ad09189-17cd-4efe-8bc1-7cd8b195769b"

# R2 Object Storage for encrypted message payloads (production)
[[env.production.r2_buckets]]
binding = "R2_MESSAGES"
bucket_name = "buds-messages-prod"

# Environment variables (production)
[env.production.vars]
ENVIRONMENT = "production"
FIREBASE_PROJECT_ID = "buds-a32e0"

# Scheduled cleanup job (runs daily at 2 AM UTC)
[triggers]
crons = ["0 2 * * *"]
